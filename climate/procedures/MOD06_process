
#PBS -S /bin/bash
#PBS -l select=1:ncpus=16:model=san
###PBS -l select=4:ncpus=8:model=neh
##PBS -l select=1:ncpus=12:model=wes
####### old: select=48:ncpus=8:mpiprocs=8:model=neh
#PBS -l walltime=2:00:00
#PBS -j oe
#PBS -m e
#PBS -V
####PBS -W group_list=s1007
#PBS -q devel
#PBS -o log/log_^array_index^
#PBS -o log/log_DataCompile
#PBS -M adam.wilson@yale.edu
#PBS -N MOD06

#source /usr/share/modules/init/bash

## cd to working directory
cd /nobackupp1/awilso10/mod06

## set some memory limits
#  ulimit -d 1500000 -m 1500000 -v 1500000  #limit memory usage
  source /u/awilso10/.bashrc
  source /usr/local/lib/global.profile
## export a few important variables
  export NCORES=16  # use to limit mclapply() to set nubmer of cores, should be select*ncpus above
  export R_LIBS="/u/awilso10/R/x86_64-unknown-linux-gnu-library/2.15/"
## load modules
  module load gcc hdf4 udunits R nco mpi-intel #mpi-sgi/mpt.2.06r6
## Run the script!
## current version not parallelizing across nodes!
  TMPDIR=$TMPDIR Rscript --verbose --vanilla /u/awilso10/environmental-layers/climate/procedures/MOD06_L2_process.r 
exit 0
exit 0

